181Q. Employees Earning More Than Their Managers

`_posts/2025-08-02-employees-earning-more-than-managers.md`


-- âœ… 1. Self Join (Straightforward and Clear)
```sql
SELECT e.name 
FROM Employee e
JOIN Employee m ON e.managerId = m.id
WHERE e.salary > m.salary;

SELECT e.name 
FROM Employee e
JOIN Employee m ON e.managerId = m.id
WHERE e.salary > m.salary;
```
---

````md
---
layout: post
title: "ðŸ‘¨â€ðŸ’¼ Employees Earning More Than Their Managers â€“ 5 SQL Techniques"
description: "Explore 5 clean and powerful SQL solutions to find employees who earn more than their managers. Includes self-join, CTE, subquery, EXISTS, and CROSS APPLY approaches."
date: 2025-08-02
author: Anupam Kumar
tags: [SQL, Self Join, CTE, EXISTS, Subquery, Interview Questions]
---
When solving real-world database problems, such as **â€œFind employees who earn more than their managersâ€**, thereâ€™s more than one correct SQL solution.
In this post, Iâ€™ll walk you through **5 different techniques** with explanations, pros, and actual SQL queries using a fictional `Employees` table.
---

## ðŸ” Assumed Table Structure

| Column       | Description            |
|--------------|------------------------|
| EmployeeID   | Unique employee ID     |
| Name         | Employee's name        |
| Salary       | Employee's salary      |
| ManagerID    | Employee's manager ID  |

---
````
## âœ… 1. Self Join â€“ Compare Employee & Manager in Same Table

This method joins the `Employees` table to itself. Itâ€™s intuitive and beginner-friendly.

```sql
SELECT e.Name AS Employee, e.Salary,
       m.Name AS Manager, m.Salary AS ManagerSalary
FROM Employees e
JOIN Employees m ON e.ManagerID = m.EmployeeID
WHERE e.Salary > m.Salary;
````

**ðŸ§  Explanation:**
You treat one copy of the table as *employee (e)* and the other as *manager (m)*. Then filter where employeeâ€™s salary > managerâ€™s salary.

---

## âœ… 2. CTE (Common Table Expression) â€“ Modular and Clean

A great choice when readability and reusability matter.

```sql
WITH EmpWithManagers AS (
  SELECT e.EmployeeID, e.Name AS EmployeeName, e.Salary AS EmployeeSalary,
         m.EmployeeID AS ManagerID, m.Name AS ManagerName, m.Salary AS ManagerSalary
  FROM Employees e
  JOIN Employees m ON e.ManagerID = m.EmployeeID
)
SELECT *
FROM EmpWithManagers
WHERE EmployeeSalary > ManagerSalary;
```

**ðŸ§  Explanation:**
CTEs make the query **modular**, easy to debug, and suitable for layering logic.

---

## âœ… 3. Subquery in WHERE â€“ Short & Elegant

Cleanest approach if you only care about employee data.

```sql
SELECT e.EmployeeID, e.Name, e.Salary, e.ManagerID
FROM Employees e
WHERE e.Salary > (
    SELECT Salary
    FROM Employees
    WHERE EmployeeID = e.ManagerID
);
```

**ðŸ§  Explanation:**
This uses a **scalar subquery** to get the manager's salary, comparing it to the employeeâ€™s salary.

---

## âœ… 4. EXISTS â€“ Efficient on Indexed Columns

Perfect when working with large datasets and proper indexing.

```sql
SELECT e.EmployeeID, e.Name, e.Salary, e.ManagerID
FROM Employees e
WHERE EXISTS (
    SELECT 1
    FROM Employees m
    WHERE m.EmployeeID = e.ManagerID
      AND e.Salary > m.Salary
);
```

**ðŸ§  Explanation:**
EXISTS checks for the **existence** of at least one manager row that satisfies the condition, avoiding full join overhead.

---

## âœ… 5. CROSS APPLY â€“ For Advanced, Row-Wise Logic

Powerful when you want row-specific subqueries.

```sql
SELECT e.EmployeeID, e.Name AS Employee, e.Salary AS EmployeeSalary,
       m.Name AS Manager, m.Salary AS ManagerSalary
FROM Employees e
CROSS APPLY (
    SELECT m.Name, m.Salary
    FROM Employees m
    WHERE m.EmployeeID = e.ManagerID
) m
WHERE e.Salary > m.Salary;
```

**ðŸ§  Explanation:**
`CROSS APPLY` allows subqueries that execute **per row**, giving great flexibility for more advanced logic or filters.

---

## ðŸ§¾ Comparison Table

| Technique        | Easy to Read | Efficient on Large Data | Ideal For                    |
| ---------------- | ------------ | ----------------------- | ---------------------------- |
| Self Join        | âœ…âœ…âœ…          | âœ…âœ…                      | Beginners, full comparison   |
| CTE              | âœ…âœ…âœ…âœ…         | âœ…âœ…                      | Modular complex logic        |
| Subquery (WHERE) | âœ…âœ…âœ…          | âœ…âœ…âœ…                     | Simplicity, direct condition |
| EXISTS           | âœ…âœ…           | âœ…âœ…âœ…âœ…                    | Index-optimized performance  |
| CROSS APPLY      | âœ…âœ…           | âœ…âœ…âœ…                     | Row-wise flexibility         |

---

## ðŸ“Œ Final Thoughts

ðŸ‘‰ Thereâ€™s **no single best way** to solve this â€” your choice depends on:

* Readability
* Dataset size
* Indexing and performance needs
* Whether you need extra columns like manager names

---

âœ¨ *Bonus Tip for Interviews:*
If asked this in interviews, explain **2 or more solutions**, and justify which you'd use based on **data size or business need**.

---

**Happy Learning & Querying!**
*â€” Anupam Kumar*
